<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <!-- marked.js for local Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked@15.0.0/marked.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #1e1e2e;
            color: #cdd6f4;
            padding: 16px;
            min-height: 100%;
        }

        h1 {
            font-size: 18px;
            font-weight: 700;
            background: linear-gradient(135deg, #89b4fa, #cba6f7);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 4px;
            text-align: center;
        }

        .subtitle {
            text-align: center;
            font-size: 11px;
            color: #6c7086;
            margin-bottom: 12px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            margin-bottom: 12px;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #313244;
        }

        .tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            background: #181825;
            color: #6c7086;
            border: none;
            transition: all 0.2s;
        }

        .tab.active {
            background: #313244;
            color: #cdd6f4;
        }

        .tab:hover:not(.active) {
            background: #1e1e2e;
        }

        /* Tab content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Server URL */
        .server-url {
            background: #181825;
            border: 1px solid #313244;
            border-radius: 8px;
            padding: 10px 14px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .server-url label {
            font-size: 11px;
            color: #6c7086;
            white-space: nowrap;
        }

        .server-url input {
            flex: 1;
            background: #11111b;
            border: 1px solid #313244;
            border-radius: 4px;
            color: #cdd6f4;
            padding: 6px 10px;
            font-size: 12px;
            font-family: monospace;
        }

        /* Markdown textarea */
        .md-input {
            width: 100%;
            height: 200px;
            background: #11111b;
            border: 1px solid #313244;
            border-radius: 8px;
            color: #cdd6f4;
            padding: 12px;
            font-size: 12px;
            font-family: 'SF Mono', Monaco, monospace;
            line-height: 1.6;
            resize: vertical;
            margin-bottom: 12px;
        }

        .md-input::placeholder {
            color: #45475a;
        }

        .md-input:focus {
            outline: none;
            border-color: #89b4fa;
        }

        .hint {
            font-size: 10px;
            color: #45475a;
            margin-bottom: 8px;
        }

        /* Buttons */
        .import-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #89b4fa, #74c7ec);
            color: #1e1e2e;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 12px;
        }

        .import-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .import-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Progress */
        .progress-section {
            background: #181825;
            border: 1px solid #313244;
            border-radius: 8px;
            padding: 12px;
            display: none;
        }

        .progress-bar {
            height: 6px;
            background: #313244;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #89b4fa, #cba6f7);
            width: 0%;
            transition: width 0.3s;
            border-radius: 3px;
        }

        .log {
            font-size: 10px;
            font-family: monospace;
            color: #a6adc8;
            max-height: 100px;
            overflow-y: auto;
            line-height: 1.8;
        }

        .log .success {
            color: #a6e3a1;
        }

        .log .error {
            color: #f38ba8;
        }

        .log .info {
            color: #89b4fa;
        }

        .done-msg {
            text-align: center;
            padding: 12px;
            background: #181825;
            border: 1px solid #a6e3a1;
            border-radius: 8px;
            color: #a6e3a1;
            font-weight: 600;
            display: none;
            margin-top: 8px;
        }

        /* Theme selector */
        .theme-selector {
            margin-bottom: 12px;
            background: #181825;
            border: 1px solid #313244;
            border-radius: 8px;
            padding: 12px;
        }

        .theme-selector label {
            display: block;
            font-size: 11px;
            color: #6c7086;
            margin-bottom: 8px;
        }

        .theme-select {
            width: 100%;
            background: #11111b;
            border: 1px solid #313244;
            border-radius: 6px;
            color: #cdd6f4;
            padding: 10px 14px;
            font-size: 12px;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%236c7086' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 14px center;
        }

        .theme-select:focus {
            outline: none;
            border-color: #89b4fa;
        }

        .theme-preview {
            display: flex;
            gap: 6px;
            margin-top: 10px;
        }

        .theme-preview-swatch {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            border: 1px solid #313244;
        }

        .theme-preview-name {
            font-size: 10px;
            color: #6c7086;
            margin-top: 6px;
        }

        /* Font size settings */
        .font-settings {
            margin-bottom: 12px;
            background: #181825;
            border: 1px solid #313244;
            border-radius: 8px;
            padding: 12px;
        }

        .font-settings-title {
            font-size: 11px;
            color: #6c7086;
            margin-bottom: 10px;
        }

        .font-settings-row {
            display: flex;
            gap: 12px;
            margin-bottom: 8px;
        }

        .font-settings-row:last-child {
            margin-bottom: 0;
        }

        .font-setting-item {
            flex: 1;
        }

        .font-setting-item label {
            display: block;
            font-size: 10px;
            color: #6c7086;
            margin-bottom: 4px;
        }

        .font-setting-item input {
            width: 100%;
            background: #11111b;
            border: 1px solid #313244;
            border-radius: 4px;
            color: #cdd6f4;
            padding: 6px 10px;
            font-size: 12px;
            text-align: center;
        }

        .font-setting-item input:focus {
            outline: none;
            border-color: #89b4fa;
        }
    </style>
</head>

<body>
    <h1>ğŸš€ DAKER Markdown Slide Creator</h1>
    <p class="subtitle">ë§ˆí¬ë‹¤ìš´ì„ í¸ì§‘ ê°€ëŠ¥í•œ Figma Slideë¡œ ìë™ ìƒì„±í•©ë‹ˆë‹¤</p>

    <!-- Theme Selector -->
    <div class="theme-selector">
        <label>ğŸ¨ í…Œë§ˆ ì„ íƒ:</label>
        <select class="theme-select" id="themeSelect" onchange="updateThemePreview()">
            <option value="clean-white">Clean White (ê¸°ë³¸)</option>
            <option value="daker-dark">DAKER Dark</option>
            <option value="daker-light">DAKER Light</option>
            <option value="corporate-blue">Corporate Blue</option>
            <option value="minimal">Minimal</option>
        </select>
        <div class="theme-preview" id="themePreview"></div>
        <div class="theme-preview-name" id="themePreviewName"></div>
    </div>

    <!-- Font Size Settings -->
    <div class="font-settings">
        <div class="font-settings-title">ğŸ“ í°íŠ¸ í¬ê¸° ì„¤ì •</div>
        <div class="font-settings-row">
            <div class="font-setting-item">
                <label>ì œëª© (ì»¤ë²„/ì—”ë”©)</label>
                <input type="number" id="fontTitleCover" value="72" min="20" max="120" />
            </div>
            <div class="font-setting-item">
                <label>ì œëª© (ì¼ë°˜)</label>
                <input type="number" id="fontTitleNormal" value="54" min="20" max="120" />
            </div>
        </div>
        <div class="font-settings-row">
            <div class="font-setting-item">
                <label>ë¶€ì œëª©</label>
                <input type="number" id="fontSubtitle" value="36" min="12" max="80" />
            </div>
            <div class="font-setting-item">
                <label>ë³¸ë¬¸</label>
                <input type="number" id="fontBody" value="24" min="12" max="60" />
            </div>
            <div class="font-setting-item">
                <label>ë¦¬ìŠ¤íŠ¸</label>
                <input type="number" id="fontList" value="26" min="12" max="60" />
            </div>
        </div>
    </div>

    <!-- Tab Switcher -->
    <div class="tabs">
        <button class="tab active" onclick="switchTab('paste')">ğŸ“ ì§ì ‘ ì…ë ¥</button>
        <button class="tab" onclick="switchTab('server')">ğŸŒ ì„œë²„ ì—°ë™</button>
    </div>

    <!-- Tab 1: Direct Paste -->
    <div class="tab-content active" id="tab-paste">
        <textarea class="md-input" id="mdInput" placeholder="ë§ˆí¬ë‹¤ìš´ì„ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”...

# ìŠ¬ë¼ì´ë“œ ì œëª©

**ê°•ì¡° í…ìŠ¤íŠ¸**

- í•­ëª© 1
- í•­ëª© 2

---

# ë‘ ë²ˆì§¸ ìŠ¬ë¼ì´ë“œ

ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
        <p class="hint">ğŸ’¡ ìŠ¬ë¼ì´ë“œ êµ¬ë¶„: --- (ìˆ˜í‰ì„ ) ì‚¬ìš©</p>
    </div>

    <!-- Tab 2: Server -->
    <div class="tab-content" id="tab-server">
        <div class="server-url">
            <label>ì„œë²„ URL:</label>
            <input type="text" id="serverUrl" value="http://localhost:9876" />
        </div>
    </div>

    <button class="import-btn" id="importBtn" onclick="startImport()">
        ğŸ“¥ ìŠ¬ë¼ì´ë“œ ìƒì„±
    </button>

    <div class="progress-section" id="progressSection">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="log" id="log"></div>
    </div>

    <div class="done-msg" id="doneMsg"></div>

    <script>
        const IMPORT_BTN = document.getElementById('importBtn');
        const PROGRESS_SECTION = document.getElementById('progressSection');
        const PROGRESS_FILL = document.getElementById('progressFill');
        const LOG = document.getElementById('log');
        const DONE_MSG = document.getElementById('doneMsg');

        let slideQueue = [];
        let currentIndex = 0;
        let totalSlides = 0;
        let currentMode = 'paste'; // 'paste' or 'server'

        // Theme preview colors (matching code.js themes)
        const THEME_PREVIEWS = {
            'clean-white': {
                name: 'Clean White - ê¹”ë”í•œ í° ë°°ê²½ (Pretendard)',
                colors: ['#ffffff', '#3C7CDE', '#333333', '#666666']
            },
            'daker-dark': {
                name: 'DAKER Dark - ì–´ë‘ìš´ ë³´ë¼ìƒ‰ ê·¸ë¼ë°ì´ì…˜',
                colors: ['#0f0c29', '#818cf8', '#c084f5', '#f472b6']
            },
            'daker-light': {
                name: 'DAKER Light - ë°ì€ ë°°ê²½',
                colors: ['#f5f5fa', '#6673d9', '#9966cc', '#d95999']
            },
            'corporate-blue': {
                name: 'Corporate Blue - ë¹„ì¦ˆë‹ˆìŠ¤ ë¸”ë£¨',
                colors: ['#1c2638', '#3380e6', '#4d99f2', '#66b3ff']
            },
            'minimal': {
                name: 'Minimal - ê¹”ë”í•œ í° ë°°ê²½',
                colors: ['#ffffff', '#1a1a1a', '#333333', '#666666']
            }
        };

        function updateThemePreview() {
            const themeId = document.getElementById('themeSelect').value;
            const theme = THEME_PREVIEWS[themeId] || THEME_PREVIEWS['daker-dark'];
            const container = document.getElementById('themePreview');
            const nameEl = document.getElementById('themePreviewName');

            container.innerHTML = theme.colors.map(c =>
                `<div class="theme-preview-swatch" style="background: ${c}"></div>`
            ).join('');
            nameEl.textContent = theme.name;
        }

        // Initialize theme preview on load
        updateThemePreview();

        function switchTab(mode) {
            currentMode = mode;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));

            if (mode === 'paste') {
                document.querySelectorAll('.tab')[0].classList.add('active');
                document.getElementById('tab-paste').classList.add('active');
            } else {
                document.querySelectorAll('.tab')[1].classList.add('active');
                document.getElementById('tab-server').classList.add('active');
            }
        }

        function addLog(text, type = '') {
            const line = document.createElement('div');
            line.className = type;
            line.textContent = text;
            LOG.appendChild(line);
            LOG.scrollTop = LOG.scrollHeight;
        }

        // Parse markdown locally using marked.lexer
        function parseMarkdownLocally(mdText) {
            const slideTexts = mdText.split(/\n---\n/).map(s => s.trim()).filter(Boolean);
            return slideTexts.map((text, index) => {
                const tokens = marked.lexer(text);
                return {
                    index: index + 1,
                    markdown: text,
                    tokens: tokens
                };
            });
        }

        async function startImport() {
            IMPORT_BTN.disabled = true;
            IMPORT_BTN.textContent = 'â³ ì²˜ë¦¬ ì¤‘...';
            PROGRESS_SECTION.style.display = 'block';
            DONE_MSG.style.display = 'none';
            LOG.innerHTML = '';
            PROGRESS_FILL.style.width = '0%';

            try {
                let slides;

                if (currentMode === 'paste') {
                    // LOCAL MODE: Parse markdown from textarea
                    const mdText = document.getElementById('mdInput').value.trim();
                    if (!mdText) throw new Error('ë§ˆí¬ë‹¤ìš´ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');

                    addLog('ğŸ“ ë§ˆí¬ë‹¤ìš´ íŒŒì‹± ì¤‘...', 'info');
                    slides = parseMarkdownLocally(mdText);
                    addLog(`âœ… ${slides.length}ê°œ ìŠ¬ë¼ì´ë“œ ê°ì§€`, 'success');

                } else {
                    // SERVER MODE: Fetch from server
                    const serverUrl = document.getElementById('serverUrl').value.replace(/\/$/, '');
                    addLog('ğŸ“‹ ì„œë²„ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ëŠ” ì¤‘...', 'info');
                    const resp = await fetch(`${serverUrl}/api/data`);
                    if (!resp.ok) throw new Error(`ì„œë²„ ì—°ê²° ì‹¤íŒ¨ (${resp.status})`);
                    const data = await resp.json();
                    slides = data.slides;
                    addLog(`âœ… ${data.total}ê°œ ìŠ¬ë¼ì´ë“œ ìˆ˜ì‹  ì™„ë£Œ`, 'success');
                }

                if (!slides || slides.length === 0) {
                    throw new Error('ìŠ¬ë¼ì´ë“œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }

                totalSlides = slides.length;
                slideQueue = slides;
                currentIndex = 0;

                addLog(`ğŸ¨ Figmaì— ìŠ¬ë¼ì´ë“œ ìƒì„± ì‹œì‘...`, 'info');
                IMPORT_BTN.textContent = 'ğŸ¨ ìŠ¬ë¼ì´ë“œ ìƒì„± ì¤‘...';
                sendNextSlide();

            } catch (err) {
                addLog(`âŒ ì˜¤ë¥˜: ${err.message}`, 'error');
                if (currentMode === 'server') {
                    addLog('ğŸ’¡ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”: node server.js', 'info');
                }
                IMPORT_BTN.disabled = false;
                IMPORT_BTN.textContent = 'ğŸ“¥ ìŠ¬ë¼ì´ë“œ ìƒì„±';
            }
        }

        function sendNextSlide() {
            if (currentIndex >= slideQueue.length) {
                parent.postMessage({
                    pluginMessage: { type: 'all-done', count: totalSlides }
                }, '*');
                return;
            }

            const slideData = slideQueue[currentIndex];
            const selectedTheme = document.getElementById('themeSelect').value;
            addLog(`ğŸ¨ ìŠ¬ë¼ì´ë“œ ${currentIndex + 1}/${totalSlides} ìƒì„± ì¤‘... (${THEME_PREVIEWS[selectedTheme]?.name || selectedTheme})`, 'info');

            const fontSizes = {
                titleCover: parseInt(document.getElementById('fontTitleCover').value) || 72,
                titleNormal: parseInt(document.getElementById('fontTitleNormal').value) || 54,
                subtitle: parseInt(document.getElementById('fontSubtitle').value) || 36,
                body: parseInt(document.getElementById('fontBody').value) || 24,
                list: parseInt(document.getElementById('fontList').value) || 26
            };

            parent.postMessage({
                pluginMessage: {
                    type: 'import-slide',
                    index: currentIndex,
                    total: totalSlides,
                    slideData: slideData,
                    theme: selectedTheme,
                    fontSizes: fontSizes
                }
            }, '*');
        }

        // Listen for messages from plugin code
        window.onmessage = (event) => {
            const msg = event.data.pluginMessage;
            if (!msg) return;

            if (msg.type === 'progress') {
                const pct = (msg.current / msg.total) * 100;
                PROGRESS_FILL.style.width = `${pct}%`;
                addLog(`âœ… ìŠ¬ë¼ì´ë“œ ${msg.current}/${msg.total} ìƒì„± ì™„ë£Œ`, 'success');
                currentIndex++;
                setTimeout(() => sendNextSlide(), 150);
            }

            if (msg.type === 'error') {
                addLog(`âŒ ìŠ¬ë¼ì´ë“œ ${msg.slide} ì˜¤ë¥˜: ${msg.message}`, 'error');
                currentIndex++;
                setTimeout(() => sendNextSlide(), 150);
            }

            if (msg.type === 'done') {
                DONE_MSG.style.display = 'block';
                DONE_MSG.textContent = `ğŸ‰ ${msg.count}ê°œ ìŠ¬ë¼ì´ë“œê°€ Figmaì— ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!`;
                IMPORT_BTN.disabled = false;
                IMPORT_BTN.textContent = 'ğŸ“¥ ë‹¤ì‹œ ìƒì„±';
                PROGRESS_FILL.style.width = '100%';
            }
        };
    </script>
</body>

</html>